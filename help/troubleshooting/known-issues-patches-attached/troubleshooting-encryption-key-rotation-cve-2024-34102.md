---
title: "Fehlerbehebung für Verschlüsselungsschlüssel-Rotation: [!DNL CVE-2024-34102]"
promoted: true
description: Wenden Sie einen zusätzlichen isolierten Patch an, um zusätzliche Fehlerbehebungen bei der Aktualisierung von Verschlüsselungsschlüsseln von [!DNL CVE-2024-34102] für Adobe Commerce 2.4.4-p8, 2.4.5-p7, 2.4.6-p5, 2.4.7 und frühere Versionen zu beheben.
feature: Compliance, Security
role: Developer
source-git-commit: 8668d08b09419d92895e3e9241280b2e68137159
workflow-type: tm+mt
source-wordcount: '927'
ht-degree: 0%

---

# Fehlerbehebung für die Verschlüsselungsschlüssel-Rotation: [!DNL CVE-2024-34102]

Dieser Artikel soll Händlern bei der Fehlerbehebung bei der Verschlüsselungsschlüsselrotation helfen, nachdem sie die in diesem [Artikel](https://experienceleague.adobe.com/en/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102) unter [!DNL CVE-2024-34102] beschriebenen Schritte bereits ausgeführt haben.

Wenn Sie bereits die Schritte im obigen Artikel ausgeführt haben und Probleme beim Drehen Ihrer Verschlüsselungsschlüssel haben, haben wir einen isolierten Patch, um potenzielle Probleme zu lösen.

Um die Schritte zu veranschaulichen, die zuvor kommuniziert und zusammengefasst wurden, um den Schutz vor [!DNL CVE-2024-34102] zu gewährleisten, sowie die zusätzliche Fehlerbehebung, die unten gefunden wurde, können Sie auch dieses Flussdiagramm verwenden:


![CVE-2024-34102 Protection Flow Chart.jpg](assets/cve-2024-34102-protection-flow-chart.jpg){zoomable="yes"}


## Anwenden des isolierten Patches zum Ausführen des neuen Befehls

Entpacken Sie die Datei und finden Sie Anweisungen unter [Anwenden eines von Adobe](https://experienceleague.adobe.com/docs/commerce-knowledge-base/kb/how-to/how-to-apply-a-composer-patch-provided-by-magento.html) bereitgestellten Composer-Patches in unserer Support-Wissensdatenbank.

## Hinzufügen eines neuen Verschlüsselungsschlüssels ohne Verwendung von Umgebungsvariablen

Das Standardverhalten der Anwendung besteht darin, den Verschlüsselungsschlüssel in der Datei `app/etc/env.php` zu speichern.

Die in der Dokumentation beschriebenen Schritte [ beschreiben, wie dieser Schlüssel in dieser Datei mithilfe der [!UICONTROL Admin] -Schnittstelle geändert werden kann.](https://experienceleague.adobe.com/en/docs/commerce-admin/systems/security/encryption-key)

Die Schritte und der isolierte Patch in diesem Abschnitt ermöglichen es Ihnen, den Wert in dieser Datei einfach zu ändern und die Probleme zu umgehen, die möglicherweise über die [!UICONTROL Admin] -Oberfläche auftreten.

Die einfachste und sicherere Methode zur Verwaltung des Verschlüsselungsschlüssels besteht jedoch in der Verwendung von Umgebungsvariablen. Wenn Sie bereits Umgebungsvariablen verwenden oder stattdessen diese zur Verwaltung dieses Schlüssels verwenden möchten, gibt es einen separaten Abschnitt, der diese Schritte beschreibt.

## Betroffene Produkte und Versionen

Adobe Commerce on Cloud, Adobe Commerce vor Ort und Magento Open Source:

* 2.4.7-p1 und früher
* 2.4.6-p6 und früher
* 2.4.5-p8 und früher
* 2.4.4-p9 und früher

## Isolierter Patch zur Fehlerbehebung für Details zur Verschlüsselungsschlüsselrotation

Verwenden Sie die folgenden angehängten Patches je nach Adobe Commerce-/Magento Open Source-Version:

### Für Version 2.4.7, 2.4.7-p1:

* [ac-12589-2-4-7x-composer-patch.zip](https://cdn.experienceleague.adobe.com/commerce-kb-assets/ac-12589-2-4-7x-composer-patch.zip)

<!--
* [ac-12589-2-4-7x-composer-patch.zip](assets/ac-12589-2-4-7x-composer-patch.zip)
-->

### Für Versionen 2.4.6, 2.4.6-p1, 2.4.6-p2, 2.4.6-p3, 2.4.6-p4, 2.4.6-p5, 2.4.6-p6:

* [ac-12589-2-4-6x-composer-patch.zip](https://cdn.experienceleague.adobe.com/commerce-kb-assets/ac-12589-2-4-6x-composer-patch.zip)

<!--
* [ac-12589-2-4-6x-composer-patch.zip](assets/ac-12589-2-4-6x-composer-patch.zip)
-->

### Für Versionen 2.4.5, 2.4.5-p1, 2.4.5-p2, 2.4.5-p3, 2.4.5-p4, 2.4.5-p5, 2.4.5-p6, 2.4.5-p7, 2.4.5-p8:

* [ac-12589-2.4.5x_COMPOSER_patch.zip](https://cdn.experienceleague.adobe.com/commerce-kb-assets/ac-12589-2-4-5x-composer-patch.zip)

<!--
* [ac-12589-2.4.5x_COMPOSER_patch.zip](assets/ac-12589-2-4-5x-composer-patch.zip)
-->

### Für Versionen 2.4.4, 2.4.4-p1, 2.4.4-p2, 2.4.4-p3, 2.4.4-p4, 2.4.4-p5, 2.4.4-p6, 2.4.4-p7, 2.4.4-p8, 2.4.4-p9:

* [ac-12589-2-4-4x-composer-patch.zip](https://cdn.experienceleague.adobe.com/commerce-kb-assets/ac-12589-2-4-4x-composer-patch.zip)

<!--
* [ac-12589-2-4-4x-composer-patch.zip](assets/ac-12589-2-4-4x-composer-patch.zip)
-->


Nachdem Sie den isolierten Patch installiert haben, ändern Sie den aktiven Verschlüsselungsschlüssel mit dem neuen Befehl [!DNL CLI] .

>[!NOTE]
>
>**Dieser neue [!DNL CLI]-Befehl Trigger bei der Ausführung einen leeren Cache.**

1. Dieser neue Befehl sollte in der Umgebung ausgeführt werden, die Ihre `app/etc/env.php` -Datei für den Schlüssel enthält, den Sie aktualisieren möchten.
1. Vergewissern Sie sich, dass der neue Befehl vorhanden ist:

   ```
   bin/magento list | grep encryption:key:change
   ```

   Die folgende Ausgabe sollte angezeigt werden:

   ```
   encryption:key:change Change the encryption key inside the env.php file.
   ```

1. Ändern Sie den Verschlüsselungsschlüssel:

   ```
   bin/magento encryption:key:change
   ```

1. Wenn Sie diesen Befehl auf Ihrem Produktionssystem ausgeführt haben, sollte keine weitere Aktion erforderlich sein.
Wenn Sie dies auf einem Entwicklungssystem ausgeführt haben, müssen Sie **1} diese Änderung in Ihr Produktionssystem übernehmen, da Sie normalerweise vertrauliche Konfigurationseinstellungen bereitstellen würden.**

## Aktualisieren Sie den Verschlüsselungsschlüssel mit Umgebungsvariablen, anstatt den isolierten Patch zu verwenden.

Als Alternative zum obigen Abschnitt können Sie mit diesen Schritten einen neuen Verschlüsselungsschlüssel hinzufügen und dabei Ihre vorhandenen verschlüsselten Daten beibehalten, selbst wenn Sie derzeit den Standard-Wert `app/etc/env.php` verwenden.
**Dieser Abschnitt gilt für Adobe Commerce on Cloud und Cloud Starter, gilt jedoch auch für Adobe Commerce On-Premise**, obwohl die genauen Schritte und Speicherorte der Variablen von Ihrer Infrastruktur abhängig sind.

### Aktuellen Wert abrufen

* Wenn Sie Ihre Schlüssel bereits mit Umgebungsvariablen verwalten, kann sich diese an [mehreren möglichen Speicherorten](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-intro) befinden, höchstwahrscheinlich jedoch in der Variablen [`CRYPT_KEY`](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-deploy#crypt_key) , wie in der Dokumentation beschrieben.
* Wenn Sie keine Variablen verwenden, befindet sich der Verschlüsselungsschlüssel im `crypt/key` -Datenschlüssel in &quot;`app/etc/env.php`&quot;.

In beiden Fällen kann es sich um einen mehrzeiligen Wert handeln, der mehrere zufällige Datenzeilen enthält.

### Generieren eines neuen Werts für 2.4.7x-Versionen

Verschlüsselungsschlüssel sind 32 Byte zufälliger Daten, die mit [!DNL base64] kodiert und mit dem Präfix `base64` versehen sind.
So generieren Sie einen neuen Schlüssel:

1. Generieren Sie mithilfe des Tools Ihrer Wahl 32 zufällige Datenbyte, die mit [!DNL base64] kodiert wurden. Mit dem [!DNL OpenSSL CLI] können Sie beispielsweise `openssl rand -base64 32` ausführen, aber es kann jedes vertrauenswürdige kryptographisch zufällige Generierungs-Tool verwendet werden.
1. Setzen Sie diesem Wert `base64` als Präfix voran. Beispiel: Wenn der Befehl `openssl` die Ausgabe *ABC123* ausgibt, würde der Wert zu: *base64ABC123*
1. Hängen Sie den generierten Wert an den vorhandenen Wert an, den Sie oben erfasst haben. Wenn Ihr vorhandener Wert beispielsweise *base64HelloWorld* ist, lautet der neue Wert:<br>

   ```
   base64HelloWorld
   base64ABC123
   ```

### Generieren eines neuen Werts für 2.4.6x und frühere Versionen

Verschlüsselungsschlüssel für 2.4.6x und frühere Versionen sind 16 Byte zufälliger Daten in einem [!DNL hex]-kodierten Format.
So generieren Sie einen neuen Schlüssel:

1. Generieren Sie mit dem Tool Ihrer Wahl 16 zufällige Datenbyte. Mit dem [!DNL OpenSSL CLI] können Sie beispielsweise `openssl rand -hex 16` ausführen, aber es kann jedes vertrauenswürdige kryptographisch zufällige Generierungs-Tool verwendet werden.
1. Hängen Sie den generierten Wert an den vorhandenen Wert an, den Sie oben erfasst haben. Wenn Ihr vorhandener Wert beispielsweise &quot;*abc123*&quot;lautet und Ihr zufälliger Wert aus dem vorherigen Schritt &quot;*456def*&quot;lautet, würde der neue Wert &quot;<br>&quot;lauten.

   ```
   abc123
   456def
   ```

### Neue Umgebungsvariable hinzufügen

Verwenden Sie den Wert [[!UICONTROL Cloud Console] oder  [!DNL magento-cloud CLI]](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/variable-levels), um die Umgebungsvariable `env:MAGENTO_DC_CRYPT__KEY` [5} auf diesen neuen Wert festzulegen.](https://experienceleague.adobe.com/en/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-cloud)

>[!NOTE]
>
>Beachten Sie, dass Sie, wenn Sie die Variable als *vertraulich* markieren, möglicherweise eine externe Sicherung dieses Werts speichern möchten, da dieser von allen Schnittstellen ausgeblendet und nur für die Anwendung sichtbar ist.

Beim Speichern der Variablen wird automatisch eine Neubereitstellung ausgelöst, die dazu führt, dass der Wert angewendet wird.

## Sicherheitsaktualisierungen

Verwandte Sicherheitsaktualisierungen für Adobe Commerce:

* [Sicherheitsupdate für Adobe Commerce - APSB24-40](https://experienceleague.adobe.com/en/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102)
* [Adobe-Sicherheitsbulletin ([!DNL APSB24-40])](https://helpx.adobe.com/security/products/magento/apsb24-40.html)
